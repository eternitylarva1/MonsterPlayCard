# PVP in the Spire - å›ºå®šé¡ºåºå‡ºç‰Œç³»ç»Ÿå®ç°æŒ‡å¯¼

## æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å¦‚ä½•åˆ©ç”¨ç°æœ‰modä»£ç ï¼Œå®ç°ä¸€ä¸ª**æŒ‰å›ºå®šé¡ºåºä»å·¦å¾€å³å‡ºç‰Œ**çš„æ•Œæ–¹ç©å®¶ç³»ç»Ÿã€‚æ ¸å¿ƒæ€è·¯æ˜¯å¤ç”¨ç°æœ‰æ¸²æŸ“å’Œå¡ç‰Œç®¡ç†ä»£ç ï¼Œç®€åŒ–å‡ºç‰Œé€»è¾‘ä¸ºå›ºå®šåºåˆ—æ‰§è¡Œã€‚

## ä¸€ã€å¯ç›´æ¥å¤ç”¨çš„ç°æœ‰ä»£ç 

### 1.1 å®Œå…¨å¯å¤ç”¨çš„ç±»

#### âœ… PlayerMonster.java
**ä½ç½®**: `src/main/java/pvp_in_the_spire/character/PlayerMonster.java`
**ç”¨é€”**: æ•Œæ–¹ç©å®¶ä¸»ä½“ç±»
**å¯ç›´æ¥ç”¨**:
- æ¸²æŸ“ç³»ç»Ÿï¼ˆè§’è‰²ç«‹ç»˜ã€è¡€æ¡ã€å§¿æ€ï¼‰
- æˆ˜æ–—ä¿¡æ¯é¢æ¿ï¼ˆBattleCardPanelï¼‰
- å……èƒ½çƒç®¡ç†ï¼ˆOrbManagerï¼‰
- å›åˆå’Œä¼¤å®³å¤„ç†

**å¤ç”¨æ–¹å¼**: ç›´æ¥å®ä¾‹åŒ–ï¼Œæ— éœ€ä¿®æ”¹
```java
PlayerMonster enemy = new PlayerMonster(
    "Enemy",      // åå­—
    false,        // pauseFlag
    x, y,         // ä½ç½®
    1,            // playerTag
    false,        // sameTeam
    cardManager   // å¡ç‰Œç®¡ç†å™¨
);
```

#### âœ… BattleCardPanel.java
**ä½ç½®**: `src/main/java/pvp_in_the_spire/ui/BattleUI/BattleCardPanel.java`
**ç”¨é€”**: æˆ˜æ–—ä¿¡æ¯é¢æ¿
**å¯ç›´æ¥ç”¨**:
- CardBoxï¼ˆæ‰‹ç‰Œæ˜¾ç¤ºï¼‰
- MonsterEnergyPanelï¼ˆèƒ½é‡æ˜¾ç¤ºï¼‰
- MonsterRelicPanelï¼ˆé—ç‰©æ˜¾ç¤ºï¼‰
- MonsterPotionPanelï¼ˆè¯æ°´æ˜¾ç¤ºï¼‰

#### âœ… CardRecorder.java
**ä½ç½®**: `src/main/java/pvp_in_the_spire/patches/CardShowPatch/CardRecorder.java`
**ç”¨é€”**: å¡ç‰Œè®°å½•å™¨
**å¯ç›´æ¥ç”¨**:
```java
CardRecorder recorder = new CardRecorder();
// recorder.cardList - å½“å‰æ‰‹ç‰Œ
// recorder.drawingCards - å³å°†æŠ½åˆ°çš„ç‰Œ
```

#### âœ… PlayerCardManager.java
**ä½ç½®**: `src/main/java/pvp_in_the_spire/player_management/PlayerCardManager.java`
**ç”¨é€”**: å¡ç‰Œç®¡ç†å™¨
**å¯ç›´æ¥ç”¨**:
- å¡ç‰ŒIDæ˜ å°„ç®¡ç†
- å¡ç‰Œå®ä¾‹è·å–
- æ‰‹ç‰Œå’ŒæŠ½ç‰Œå †æ›´æ–°

### 1.2 éœ€è¦å°‘é‡ä¿®æ”¹çš„ç±»

#### âš ï¸ UseCardSend.javaï¼ˆéƒ¨åˆ†ä¿®æ”¹ï¼‰
**éœ€è¦ä¿ç•™**:
- `monsterCardMap` - æ•Œæ–¹å¡ç‰Œæ˜ å°„
- `receiveCardInfo()` - æ¥æ”¶å¡ç‰Œä¿¡æ¯
- `useCardDecode()` - æ˜¾ç¤ºå¯¹æ–¹å‡ºçš„ç‰Œ

**éœ€è¦ä¿®æ”¹**:
- ç§»é™¤å‡ºç‰Œæ‹¦æˆªè¡¥ä¸ï¼ˆ`SendUseCardAction` ç±»ï¼‰
- ç®€åŒ–å¡ç‰ŒIDç”Ÿæˆé€»è¾‘

**åˆ é™¤è¿™äº›éƒ¨åˆ†**:
```java
// åˆ é™¤æ•´ä¸ª SendUseCardAction ç±»
@SpirePatch(clz = AbstractPlayer.class, method = "useCard")
public static class SendUseCardAction {
    // ... å…¨éƒ¨åˆ é™¤
}
```

#### âš ï¸ HandCardSend.javaï¼ˆç®€åŒ–ä½¿ç”¨ï¼‰
**ä¿ç•™**:
- `monsterCardList` - æ•Œæ–¹æ‰‹ç‰Œè®°å½•
- `handCardDecode()` - è§£ç æ‰‹ç‰Œæ›´æ–°

**åˆ é™¤**:
- `HandCardRefreshEvent` è¡¥ä¸ç±»ï¼ˆä¸éœ€è¦ç›‘å¬æ‰‹ç‰Œå˜åŒ–ï¼‰

## äºŒã€æ–°å¢/ä¿®æ”¹çš„ä»£ç 

### 2.1 FixedSequencePlayerï¼ˆå›ºå®šé¡ºåºå‡ºç‰Œç©å®¶ï¼‰

#### æ–°å¢ FixedSequencePlayer.java
```java
package pvp_in_the_spire.character;

import com.megacrit.cardcrawl.cards.AbstractCard;
import com.megacrit.cardcrawl.dungeons.AbstractDungeon;
import pvp_in_the_spire.player_management.PlayerCardManager;
import pvp_in_the_spire.patches.CardShowPatch.CardRecorder;
import pvp_in_the_spire.ui.BattleUI.BattleCardPanel;

import java.util.ArrayList;
import java.util.List;

/**
 * å›ºå®šé¡ºåºå‡ºç‰Œç©å®¶
 * æŒ‰ç…§é¢„è®¾çš„å‡ºç‰Œåºåˆ—ï¼Œä»å·¦å¾€å³ä¾æ¬¡å‡ºç‰Œ
 */
public class FixedSequencePlayer extends PlayerMonster {

    // é¢„è®¾çš„å‡ºç‰Œåºåˆ—ï¼ˆå¡ç‰ŒIDåˆ—è¡¨ï¼‰
    private List<Integer> playSequence;
    // å½“å‰å‡ºç‰Œä½ç½®
    private int currentPlayIndex = 0;
    // æ˜¯å¦æ­£åœ¨å‡ºç‰Œ
    private boolean isPlaying = false;

    public FixedSequencePlayer(String name, boolean pauseFlag, float x, float y,
                              int playerTag, boolean sameTeam,
                              PlayerCardManager cardManager,
                              List<Integer> playSequence) {
        super(name, pauseFlag, x, y, playerTag, sameTeam, cardManager);
        this.playSequence = new ArrayList<>(playSequence);
    }

    /**
     * æ‰§è¡Œå›ºå®šé¡ºåºå‡ºç‰Œ
     */
    public void playFixedSequence() {
        if (isPlaying || currentPlayIndex >= playSequence.size()) {
            return;
        }

        isPlaying = true;

        new Thread(() -> {
            try {
                // å›åˆå¼€å§‹
                Thread.sleep(500);
                onTurnStart();

                // æŒ‰é¡ºåºå‡ºç‰Œ
                while (currentPlayIndex < playSequence.size()) {
                    Integer cardId = playSequence.get(currentPlayIndex);
                    AbstractCard card = getCardById(cardId);

                    if (card != null && canPlayCard(card)) {
                        // å‡ºè¿™å¼ ç‰Œ
                        playCard(card);
                        currentPlayIndex++;

                        // å‡ºç‰Œé—´éš”
                        Thread.sleep(800);
                    } else {
                        // å¦‚æœä¸èƒ½å‡ºï¼Œè·³è¿‡è¿™å¼ ç‰Œ
                        currentPlayIndex++;
                    }
                }

                // å›åˆç»“æŸ
                Thread.sleep(500);
                onTurnEnd();

            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            } finally {
                isPlaying = false;
            }
        }).start();
    }

    /**
     * å›åˆå¼€å§‹
     */
    private void onTurnStart() {
        System.out.println("[FIXED] Turn started, will play " +
            (playSequence.size() - currentPlayIndex) + " more cards");

        // é‡ç½®èƒ½é‡
        setEnergy(3);

        // æŠ½ç‰Œï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä»æŠ½ç‰Œå †è·å–ï¼‰
        drawCards(5);
    }

    /**
     * å‡ºç‰Œ
     */
    private void playCard(AbstractCard card) {
        System.out.println("[FIXED] Playing: " + card.name +
            " (" + card.cost + " energy)");

        // æ¶ˆè€—èƒ½é‡
        int currentEnergy = getCurrentEnergy();
        if (card.cost <= currentEnergy) {
            setEnergy(currentEnergy - card.cost);

            // æ¨¡æ‹Ÿå‡ºç‰Œæ•ˆæœ
            simulateCardEffect(card);

            // ä»æ‰‹ç‰Œç§»é™¤
            removeCardFromHand(card);

            // æ˜¾ç¤ºå‡ºç‰Œæ•ˆæœ
            showCardPlayed(card);
        } else {
            System.out.println("[FIXED] Not enough energy for " + card.name);
        }
    }

    /**
     * å›åˆç»“æŸ
     */
    private void onTurnEnd() {
        System.out.println("[FIXED] Turn ended");
        endOfTurnTrigger();
    }

    /**
     * æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡ºè¿™å¼ ç‰Œ
     */
    private boolean canPlayCard(AbstractCard card) {
        return card.cost <= getCurrentEnergy();
    }

    /**
     * æ¨¡æ‹Ÿå¡ç‰Œæ•ˆæœ
     */
    private void simulateCardEffect(AbstractCard card) {
        switch (card.type) {
            case ATTACK:
                // æ”»å‡»ç©å®¶
                AbstractDungeon.player.damage(
                    new com.megacrit.cardcrawl.cards.DamageInfo(this, card.baseDamage)
                );
                break;

            case SKILL:
                // ç»™è‡ªå·±åŠ æ ¼æŒ¡
                this.addBlock(card.baseBlock);
                break;

            case POWER:
                // èƒ½åŠ›ç‰Œæ•ˆæœï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
                System.out.println("[FIXED] Power activated: " + card.name);
                break;
        }
    }

    /**
     * ä»æ‰‹ç‰Œç§»é™¤å¡ç‰Œ
     */
    private void removeCardFromHand(AbstractCard card) {
        if (battleCardPanel != null &&
            battleCardPanel.cardBox != null &&
            battleCardPanel.cardBox.shownCards != null) {
            battleCardPanel.cardBox.shownCards.cardList.remove(card);
        }
    }

    /**
     * æ˜¾ç¤ºå‡ºç‰Œæ•ˆæœ
     */
    private void showCardPlayed(AbstractCard card) {
        // ä½¿ç”¨ç°æœ‰çš„æ˜¾ç¤ºç³»ç»Ÿ
        card.unfadeOut();
        AbstractDungeon.effectList.add(
            new com.megacrit.cardcrawl.vfx.cardManip.ShowCardBrieflyEffect(card)
        );
    }

    /**
     * æŠ½ç‰Œ
     */
    private void drawCards(int num) {
        System.out.println("[FIXED] Drawing " + num + " cards");

        // è¿™é‡Œåº”è¯¥ä»æŠ½ç‰Œå †æŠ½å–
        // ç®€åŒ–å¤„ç†ï¼šä»å‡ºç‰Œåºåˆ—ä¸­å–ç‰Œåˆ°æ‰‹ç‰Œ
        CardRecorder recorder = battleCardPanel.cardBox.shownCards;
        for (int i = 0; i < num && currentPlayIndex < playSequence.size(); i++) {
            Integer cardId = playSequence.get(currentPlayIndex);
            AbstractCard card = getCardById(cardId);
            if (card != null) {
                recorder.cardList.add(card);
            }
            currentPlayIndex++;
        }
    }

    /**
     * è·å–å½“å‰èƒ½é‡
     */
    private int getCurrentEnergy() {
        if (battleCardPanel != null &&
            battleCardPanel.energyPanel != null) {
            // è¿™é‡Œéœ€è¦ä»UIé¢æ¿è·å–èƒ½é‡
            // ç®€åŒ–å¤„ç†ï¼Œä½¿ç”¨å†…éƒ¨å˜é‡
            return currentEnergy;
        }
        return 0;
    }

    /**
     * è®¾ç½®èƒ½é‡
     */
    private void setEnergy(int energy) {
        currentEnergy = energy;
        if (battleCardPanel != null) {
            battleCardPanel.setEnergy(energy);
        }
    }

    // å†…éƒ¨èƒ½é‡å­˜å‚¨ï¼ˆç®€åŒ–å¤„ç†ï¼‰
    private int currentEnergy = 3;

    /**
     * æ ¹æ®IDè·å–å¡ç‰Œ
     */
    private AbstractCard getCardById(int cardId) {
        if (playerCardManager != null) {
            return playerCardManager.getCard(cardId);
        }
        return null;
    }

    /**
     * é‡ç½®å‡ºç‰Œåºåˆ—ï¼ˆç”¨äºæ–°å›åˆï¼‰
     */
    public void resetSequence() {
        currentPlayIndex = 0;
    }

    /**
     * è·å–å‰©ä½™å‡ºç‰Œæ•°
     */
    public int getRemainingCards() {
        return playSequence.size() - currentPlayIndex;
    }
}
```

### 2.2 å‡ºç‰Œåºåˆ—ç”Ÿæˆå™¨

#### æ–°å¢ SequenceGenerator.java
```java
package pvp_in_the_spire.util;

import com.megacrit.cardcrawl.cards.AbstractCard;
import com.megacrit.cardcrawl.helpers.CardLibrary;

import java.util.ArrayList;
import java.util.List;

/**
 * å‡ºç‰Œåºåˆ—ç”Ÿæˆå™¨
 * å°†å¡ç‰ŒIDåˆ—è¡¨è½¬æ¢ä¸ºå‡ºç‰Œåºåˆ—
 */
public class SequenceGenerator {

    /**
     * ä»å¡ç‰Œåç§°åˆ—è¡¨ç”Ÿæˆå‡ºç‰Œåºåˆ—
     */
    public static List<Integer> generateSequence(List<String> cardNames) {
        List<Integer> sequence = new ArrayList<>();

        for (String cardName : cardNames) {
            if (CardLibrary.cards.containsKey(cardName)) {
                AbstractCard card = CardLibrary.cards.get(cardName);
                // ä½¿ç”¨å¡ç‰Œçš„å“ˆå¸Œç ä½œä¸ºID
                sequence.add(cardName.hashCode());
            }
        }

        return sequence;
    }

    /**
     * ä»å¡ç‰Œå®ä¾‹åˆ—è¡¨ç”Ÿæˆå‡ºç‰Œåºåˆ—
     */
    public static List<Integer> generateSequenceFromCards(List<AbstractCard> cards) {
        List<Integer> sequence = new ArrayList<>();

        for (AbstractCard card : cards) {
            sequence.add(card.cardID.hashCode());
        }

        return sequence;
    }

    /**
     * ç”Ÿæˆå¾ªç¯å‡ºç‰Œåºåˆ—ï¼ˆå‡ºå®Œä¸€è½®åé‡æ–°å¼€å§‹ï¼‰
     */
    public static List<Integer> generateLoopingSequence(List<String> cardNames, int loops) {
        List<Integer> baseSequence = generateSequence(cardNames);
        List<Integer> fullSequence = new ArrayList<>();

        for (int i = 0; i < loops; i++) {
            fullSequence.addAll(baseSequence);
        }

        return fullSequence;
    }

    /**
     * ç¤ºä¾‹ï¼šé¢„è®¾å¡ç»„åºåˆ—
     */
    public static List<String> getSampleDeckSequence() {
        List<String> sequence = new ArrayList<>();

        // ç¤ºä¾‹ï¼šæ”»å‡»ç‰Œå¾ªç¯
        for (int i = 0; i < 10; i++) {
            sequence.add("Strike_Red");
            sequence.add("Strike_Red");
            sequence.add("Defend_Red");
        }

        // ç¤ºä¾‹ï¼šæŠ€èƒ½ç‰Œ
        sequence.add("Bash");
        sequence.add("Anger");

        return sequence;
    }
}
```

## ä¸‰ã€æœ€å°ä¿®æ”¹æ–¹æ¡ˆ

### 3.1 åˆ›å»ºæ­¥éª¤

#### æ­¥éª¤1ï¼šå¤åˆ¶ç°æœ‰ç±»
1. å¤åˆ¶ `PlayerMonster.java` â†’ é‡å‘½åä¸º `FixedSequencePlayer.java`
2. ä¿®æ”¹ç»§æ‰¿å…³ç³»ï¼š`extends PlayerMonster`
3. æ·»åŠ å‡ºç‰Œåºåˆ—å­—æ®µå’Œæ–¹æ³•

#### æ­¥éª¤2ï¼šä¿®æ”¹UseCardSend.java
åˆ é™¤ `SendUseCardAction` ç±»ï¼ˆå¤§çº¦ç¬¬252-300è¡Œï¼‰ï¼š
```java
// åˆ é™¤è¿™ä¸ªæ•´ä¸ªç±»
@SpirePatch(clz = AbstractPlayer.class, method = "useCard")
public static class SendUseCardAction {
    // ... å…¨éƒ¨åˆ é™¤
}
```

#### æ­¥éª¤3ï¼šåˆ›å»ºåºåˆ—ç”Ÿæˆå™¨
ä½¿ç”¨ä¸Šé¢çš„ `SequenceGenerator.java`

#### æ­¥éª¤4ï¼šåœ¨æˆ˜æ–—ä¸­ä½¿ç”¨
```java
// åœ¨æˆ˜æ–—åˆå§‹åŒ–æ—¶
List<String> deckSequence = SequenceGenerator.getSampleDeckSequence();
List<Integer> playSequence = SequenceGenerator.generateSequence(deckSequence);

FixedSequencePlayer enemy = new FixedSequencePlayer(
    "Fixed Player",
    false,  // pauseFlag
    x, y,   // ä½ç½®
    1,      // playerTag
    false,  // sameTeam
    cardManager,
    playSequence
);

// æ·»åŠ åˆ°æˆ˜æ–—
AbstractDungeon.getCurrRoom().monsters.addMonster(enemy);
```

### 3.2 å…³é”®ä¿®æ”¹ç‚¹

#### ä¿®æ”¹1ï¼šPlayerMonster.java
åœ¨ `takeTurn()` æ–¹æ³•ä¸­æ·»åŠ è‡ªåŠ¨å‡ºç‰Œï¼š
```java
@Override
public void takeTurn() {
    if (this.pauseFlag) {
        System.out.printf("%d take turn\n", playerTag);
        AbstractDungeon.actionManager.addToBottom(
            new MultiPauseAction()
        );
    }

    // å¦‚æœæ˜¯FixedSequencePlayerï¼Œè‡ªåŠ¨å‡ºç‰Œ
    if (this instanceof FixedSequencePlayer) {
        ((FixedSequencePlayer) this).playFixedSequence();
    }
}
```

#### ä¿®æ”¹2ï¼šç§»é™¤ç½‘ç»œä¾èµ–
åœ¨ `SocketServer.java` ä¸­ï¼š
```java
// ä¸´æ—¶ç¦ç”¨ç½‘ç»œï¼Œç”¨äºæµ‹è¯•
public static boolean USE_NETWORK = false;
```

## å››ã€å®Œæ•´ç¤ºä¾‹ä»£ç 

### 4.1 ç®€å•ä½¿ç”¨ç¤ºä¾‹

```java
package pvp_in_the_spire.example;

import pvp_in_the_spire.character.FixedSequencePlayer;
import pvp_in_the_spire.player_management.PlayerCardManager;
import pvp_in_the_spire.util.SequenceGenerator;
import com.megacrit.cardcrawl.dungeons.AbstractDungeon;

import java.util.Arrays;
import java.util.List;

public class FixedPlayerExample {

    public static void createFixedPlayer() {
        // 1. å‡†å¤‡å¡ç‰Œåºåˆ—
        List<String> cardNames = Arrays.asList(
            "Strike_Red", "Strike_Red", "Defend_Red",
            "Bash", "Anger",
            "Strike_Red", "Defend_Red"
        );

        // 2. ç”Ÿæˆå‡ºç‰Œåºåˆ—
        List<Integer> playSequence = SequenceGenerator.generateSequence(cardNames);

        // 3. åˆ›å»ºå¡ç‰Œç®¡ç†å™¨
        PlayerCardManager cardManager = new PlayerCardManager();

        // 4. åˆ›å»ºå›ºå®šå‡ºç‰Œç©å®¶
        FixedSequencePlayer enemy = new FixedSequencePlayer(
            "Training Dummy",  // åå­—
            false,             // pauseFlag
            0, 0,              // ä½ç½®ï¼ˆç¨åè°ƒæ•´ï¼‰
            1,                 // playerTag
            false,             // sameTeam
            cardManager,
            playSequence
        );

        // 5. æ·»åŠ åˆ°æˆ˜æ–—
        AbstractDungeon.getCurrRoom().monsters.addMonster(enemy);

        System.out.println("[EXAMPLE] Created fixed sequence player with " +
            playSequence.size() + " cards in sequence");
    }
}
```

### 4.2 é…ç½®æ–‡ä»¶æ–¹å¼

#### æ–°å¢ FixedPlayerConfig.java
```java
package pvp_in_the_spire.config;

import java.util.Arrays;
import java.util.List;

/**
 * å›ºå®šå‡ºç‰Œç©å®¶é…ç½®
 */
public class FixedPlayerConfig {

    // é»˜è®¤å¡ç‰Œåºåˆ—
    public static final List<String> DEFAULT_SEQUENCE = Arrays.asList(
        "Strike_Red", "Strike_Red", "Strike_Red", "Strike_Red", "Strike_Red",
        "Defend_Red", "Defend_Red", "Defend_Red", "Defend_Red",
        "Bash", "Anger"
    );

    // æ˜¯å¦å¯ç”¨å›ºå®šå‡ºç‰Œæ¨¡å¼
    public static boolean ENABLED = true;

    // å‡ºç‰Œé—´éš”ï¼ˆæ¯«ç§’ï¼‰
    public static int PLAY_DELAY = 800;

    // æ˜¯å¦æ˜¾ç¤ºæ—¥å¿—
    public static boolean SHOW_LOG = true;
}
```

## äº”ã€æµ‹è¯•å’Œè°ƒè¯•

### 5.1 æµ‹è¯•æ­¥éª¤
1. åˆ›å»ºå›ºå®šå‡ºç‰Œç©å®¶
2. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—
3. éªŒè¯å¡ç‰Œæ˜¾ç¤º
4. æ£€æŸ¥å‡ºç‰Œæ•ˆæœ

### 5.2 é¢„æœŸæ—¥å¿—è¾“å‡º
```
[FIXED] Turn started, will play 10 more cards
[FIXED] Drawing 5 cards
[FIXED] Playing: Strike (1 energy)
[FIXED] Playing: Strike (1 energy)
[FIXED] Playing: Defend (1 energy)
[FIXED] Playing: Bash (2 energy)
[FIXED] Turn ended
```

## å…­ã€å¸¸è§é—®é¢˜è§£å†³

### 6.1 å¡ç‰Œä¸å‡ºç‰Œ
**åŸå› **: èƒ½é‡ä¸è¶³æˆ–å¡ç‰ŒIDä¸åŒ¹é…
**è§£å†³**: æ£€æŸ¥å‡ºç‰Œåºåˆ—å’Œèƒ½é‡è®¾ç½®

### 6.2 å¡ç‰Œæ•ˆæœä¸ç”Ÿæ•ˆ
**åŸå› **: simulateCardEffect()æ–¹æ³•æœªæ­£ç¡®å®ç°
**è§£å†³**: æ ¹æ®å¡ç‰Œç±»å‹æ·»åŠ ç›¸åº”æ•ˆæœ

### 6.3 æ¸²æŸ“é—®é¢˜
**åŸå› **: CardRecorderæœªæ­£ç¡®æ›´æ–°
**è§£å†³**: ç¡®ä¿æ‰‹ç‰Œåˆ—è¡¨æ­£ç¡®åŒæ­¥

## ä¸ƒã€æ‰©å±•å»ºè®®

### 7.1 æ·»åŠ æ¡ä»¶å‡ºç‰Œ
```java
// æ ¹æ®è¡€é‡å†³å®šæ˜¯å¦å‡ºé˜²å¾¡ç‰Œ
if (this.currentHealth < this.maxHealth * 0.3 && card.baseBlock > 0) {
    // ä½è¡€é‡æ—¶ä¼˜å…ˆé˜²å¾¡
    priority += 10;
}
```

### 7.2 æ·»åŠ å¾ªç¯å‡ºç‰Œ
```java
// å‡ºå®Œä¸€è½®åé‡æ–°å¼€å§‹
if (currentPlayIndex >= playSequence.size()) {
    currentPlayIndex = 0;
}
```

### 7.3 æ·»åŠ éšæœºå˜åŒ–
```java
// 80%æŒ‰é¡ºåºï¼Œ20%éšæœºå‡ºç‰Œ
if (Math.random() < 0.2) {
    card = getRandomPlayableCard();
} else {
    card = getNextCardInSequence();
}
```

## å…«ã€æ€»ç»“

### âœ… æœ€å°å®ç°è·¯å¾„
1. **å¤ç”¨PlayerMonster** - ç›´æ¥ä½¿ç”¨ç°æœ‰æ¸²æŸ“å’Œæˆ˜æ–—é€»è¾‘
2. **æ·»åŠ FixedSequencePlayer** - ç»§æ‰¿å¹¶æ·»åŠ å‡ºç‰Œåºåˆ—
3. **ç§»é™¤UseCardSendæ‹¦æˆª** - ç®€åŒ–å¡ç‰Œå¤„ç†
4. **é…ç½®å‡ºç‰Œåºåˆ—** - ç”¨SequenceGeneratorç”Ÿæˆ

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
- **æœ€å°ä¿®æ”¹** - å¤§éƒ¨åˆ†ä»£ç ç›´æ¥å¤ç”¨
- **ç®€å•å¯é ** - å›ºå®šé¡ºåºï¼Œä¸æ¶‰åŠå¤æ‚AI
- **æ˜“äºè°ƒè¯•** - æ—¥å¿—æ¸…æ™°ï¼Œé—®é¢˜å®šä½å®¹æ˜“
- **å¯æ‰©å±•** - åç»­å¯æ·»åŠ æ¡ä»¶åˆ¤æ–­å’Œéšæœºæ€§

è¿™ä¸ªæ–¹æ¡ˆæä¾›äº†æœ€ç®€å•çš„å›ºå®šé¡ºåºå‡ºç‰Œå®ç°ï¼Œå‡ ä¹ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ç³»ç»Ÿå°±èƒ½å·¥ä½œï¼