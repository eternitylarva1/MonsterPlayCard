# 卡牌显示修复报告

## 问题描述
用户的需求是只显示手牌，但当前实现错误地显示了抽牌堆中的所有卡牌。这导致第一回合就显示10张牌（5张手牌+5张抽牌堆），而不是只显示5张手牌。

## 问题分析
1. 当前`refreshDisplayedCards()`方法显示的是`monsterDrawPile`（抽牌堆）中的所有卡牌
2. 系统缺少独立的手牌（CardGroup）来存储手牌
3. 出牌逻辑直接从抽牌堆中移除卡牌，而不是先抽到手牌再打出
4. 预测系统基于抽牌堆而不是手牌

## 修复方案

### 1. 添加手牌系统
- 在MonsterCardPlayer类中添加了`monsterHand`字段：
```java
private CardGroup monsterHand;                         // 怪物手牌
```

### 2. 修改初始化逻辑
- 在`initializeCardSystem()`方法中初始化手牌：
```java
monsterHand = new CardGroup(CardGroup.CardGroupType.HAND);
```
- 在初始化完成后，从抽牌堆抽5张到手牌：
```java
// 初始抽牌：从抽牌堆抽5张到手牌
drawCardsToHand(5);
```

### 3. 实现抽牌逻辑
- 添加了`drawCardsToHand(int count)`方法，从抽牌堆移动指定数量的卡牌到手牌
- 在回合开始时自动抽1张牌：
```java
// 回合开始时抽1张牌（保持手牌数量）
drawCardsToHand(1);
```

### 4. 修改显示逻辑
- 修改`refreshDisplayedCards()`方法，只显示手牌中的卡牌：
```java
// 显示手牌中的所有卡牌
int maxDisplay = monsterHand.size();
for (int i = 0; i < maxDisplay; i++) {
    AbstractCard card = monsterHand.group.get(i);
    // ...
}
```

### 5. 修改出牌逻辑
- 修改`playCardsWithAnimation()`方法，从手牌而不是抽牌堆出牌：
```java
while (availableEnergy > 0 && (monsterHand != null && !monsterHand.isEmpty())) {
    // ...
}
```
- 修改`getBestPlayableCard()`方法，从手牌获取可出的卡牌：
```java
for (AbstractCard card : monsterHand.group) {
    // ...
}
```
- 添加`removeCardFromHand()`方法，从手牌移除卡牌：
```java
private void removeCardFromHand(AbstractCard cardToRemove) {
    if (monsterHand != null && cardToRemove != null) {
        monsterHand.removeCard(cardToRemove);
    }
}
```

### 6. 修改预测系统
- 修改`predictCardsForTurn()`方法，基于手牌而不是抽牌堆进行预测：
```java
// 从左往右遍历卡牌，累计计算能量消耗
if (monsterHand != null && !monsterHand.isEmpty()) {
    for (AbstractCard card : monsterHand.group) {
        // ...
    }
}
```

### 7. 添加辅助方法
- 添加了`getHandSize()`方法获取手牌大小：
```java
public int getHandSize() {
    return monsterHand != null ? monsterHand.size() : 0;
}
```

## 修复效果
1. **只显示手牌**：现在只显示手牌中的卡牌，而不是抽牌堆中的所有卡牌
2. **正确的卡牌流程**：抽牌堆 → 手牌 → 出牌 → 弃牌堆
3. **正确的显示数量**：第一回合只显示5张手牌，而不是10张牌
4. **正确的预测系统**：基于手牌进行卡牌预测，而不是抽牌堆

## 测试建议
1. 启动游戏，观察怪物头顶是否只显示5张手牌
2. 观察回合开始时是否自动抽1张牌
3. 观察出牌时是否从手牌移除卡牌
4. 观察预测系统是否基于手牌工作

## 总结
通过添加独立的手牌系统，并修改相关的显示、出牌和预测逻辑，成功修复了卡牌显示错误。现在系统正确地区分了抽牌堆和手牌的概念，只显示手牌中的卡牌，符合用户的预期需求。